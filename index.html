<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Appointment confirmation of Italy embassy in Tehran</title>
    <style>
        /* Base Styles and Layout (Formal Design) */
        body {
            font-family: 'Times New Roman', Times, serif; /* Formal font for official look */
            margin: 0;
            padding: 0;
            background-color: #f0f0f0; /* Light Gray for official background */
            color: #1a1a1a;
        }

        /* 2. Enhanced Loading Screen */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.98); /* Almost opaque white */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 1;
            transition: opacity 0.5s;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        /* Stylish Rotating Loading Spinner (CSS-based for better quality than GIF) */
        .spinner {
            border: 8px solid #f3f3f3; /* Light grey */
            border-top: 8px solid #8B0000; /* Dark Red - Official Color */
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 2s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* 3. Larger Header */
        header {
            background-color: #8B0000; /* Dark Red */
            color: white;
            padding: 25px 40px; /* Increased padding for larger look */
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); /* Stronger shadow */
            position: sticky;
            top: 0;
            z-index: 500;
        }

        header h1 {
            margin: 0;
            font-size: 1.8em; /* Larger title */
            font-weight: bold;
            letter-spacing: 1px;
        }

        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
        }

        nav ul li {
            margin-left: 30px; /* Increased spacing */
        }

        nav ul li a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            font-size: 1.1em;
            padding: 5px 0;
            border-bottom: 2px solid transparent;
            transition: border-bottom 0.3s, color 0.3s;
        }

        nav ul li a:hover {
            color: #ffcccb;
            border-bottom: 2px solid #ffcccb;
        }

        /* Main Container */
        .container {
            display: flex;
            min-height: calc(100vh - 200px); /* Adjust based on larger header/footer height */
            max-width: 1300px;
            margin: 0 auto;
            padding: 20px 0;
        }

        /* Sidebar (Left side) */
        .sidebar {
            width: 220px;
            background-color: #ffffff;
            padding: 30px 20px;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
            border-right: 5px solid #8B0000;
            border-radius: 0 5px 5px 0;
            height: fit-content;
        }

        .sidebar h3 {
            color: #8B0000;
            border-bottom: 3px solid #ccc;
            padding-bottom: 10px;
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        .sidebar ul {
            list-style: none;
            padding: 0;
        }

        .sidebar ul li {
            margin-bottom: 10px;
        }

        .sidebar ul li a {
            display: block;
            padding: 10px 10px;
            color: #333;
            text-decoration: none;
            border-left: 3px solid transparent;
            transition: background-color 0.3s, border-left 0.3s;
        }

        .sidebar ul li a:hover {
            background-color: #f5f5f5;
            border-left: 3px solid #8B0000;
        }

        /* Main Content Area */
        .main-content {
            flex-grow: 1;
            padding: 0 40px;
        }

        .content-section {
            background-color: white;
            padding: 40px;
            border-radius: 8px;
            border: 1px solid #ddd;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .content-section h2 {
            color: #8B0000;
            border-bottom: 2px solid #ccc;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 1em;
        }
        
        /* Buttons */
        .form-action-btn {
            background-color: #8B0000;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.1s;
        }

        .form-action-btn:hover:not(:disabled) {
            background-color: #a01010;
        }

        .form-action-btn:active:not(:disabled) {
            transform: translateY(1px);
        }

        .form-action-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* Alert/Error Message */
        .message {
            margin-top: 25px;
            padding: 18px;
            border-radius: 4px;
            font-weight: bold;
            display: none;
            border-left: 5px solid;
        }

        .error {
            background-color: #f8d7da;
            color: #721c24;
            border-left-color: #721c24;
        }

        .success {
             background-color: #d4edda;
            color: #155724;
            border-left-color: #155724;
        }

        /* Detail Card */
        .detail-card-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .detail-item {
            background-color: #f9f9f9;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .detail-item strong {
            display: block;
            color: #8B0000;
            font-size: 0.9em;
            margin-bottom: 5px;
        }

        /* Payment Progress Bar */
        .progress-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
        }
        .progress-step {
            width: 25%;
            text-align: center;
            font-weight: bold;
            color: #aaa;
            border-bottom: 4px solid #ccc;
            padding-bottom: 10px;
            transition: all 0.3s;
        }
        .progress-step.active {
            color: #8B0000;
            border-color: #8B0000;
        }

        /* Larger Footer */
        footer {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 25px 0; /* Increased padding for larger look */
            font-size: 0.9em;
            margin-top: 20px;
            border-top: 5px solid #8B0000;
        }
        
        footer p {
            margin: 5px 0;
        }

    </style>
</head>
<body>

    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
        <p style="color: #8B0000; font-weight: bold;">Processing Request... Please wait 5 seconds.</p>
    </div>

    <header>
        <h2>Book Appointment confirmation of Italy embassy in Tehran</h2>
        <nav>
            <ul>
                <li><a href="#" onclick="showSection('trackingSection')">Home page</a></li>
                <li><a href="#">General Informations</a></li>
                <li><a href="#">Visa Procedures</a></li>
                <li><a href="#">Additional Services</a></li>
                <li><a href="#">F.A.Q</a></li>
                <li><a href="#">Contacts</a></li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <aside class="sidebar">
            <h3>Quick Access</h3>
            <ul>
                <li><a href="#">Visa Application Guide</a></li>
                <li><a href="#">Required Documentation</a></li>
                <li><a href="#">Latest News & Updates</a></li>
                <li><a href="#">Contact Official Desk</a></li>
            </ul>
        </aside>

        <main class="main-content">
            
            <div id="trackingSection" class="content-section">
                <h2>Application Status Tracking</h2>
                <form id="trackingForm">
                    <div class="form-group">
                        <label for="name">1. Name</label>
                        <input type="text" id="name" name="name" required>
                    </div>
                    <div class="form-group">
                        <label for="lastName">2. Last Name</label>
                        <input type="text" id="lastName" name="lastName" required>
                    </div>
                    <div class="form-group">
                        <label for="nationality">3. Nationality</label>
                        <input type="text" id="nationality" name="nationality" required>
                    </div>
                    <div class="form-group">
                        <label for="nationalId">4. National ID No</label>
                        <input type="text" id="nationalId" name="nationalId" required>
                    </div>
                    <div class="form-group">
                        <label for="ceuNumber">5. CEU Number</label>
                        <input type="text" id="ceuNumber" name="ceuNumber" required>
                    </div>
                    <button type="submit" id="trackBtn" class="form-action-btn" disabled>Track Now</button>
                    <div id="trackMessage" class="message error"></div>
                </form>
            </div>

            <div id="detailsSection" class="content-section" style="display: none;">
                <h2>Appointment and Case Approval Details</h2>
                <div id="applicantInfo" class="detail-card-container">
                    </div>
                
                <button id="proceedPaymentBtn" class="form-action-btn" style="background-color: #008000; margin-top: 30px;">Proceed to Payment</button>
            </div>
            
            <div id="paymentSection" class="content-section" style="display: none;">
                <h2>Payment Process - Visa Fee</h2>
                
                <div class="progress-bar">
                    <div id="step1Header" class="progress-step active">Step 1: Applicant Info</div>
                    <div id="step2Header" class="progress-step">Step 2: Card Details</div>
                    <div id="step3Header" class="progress-step">Step 3: Confirmation</div>
                    <div id="step4Header" class="progress-step">Step 4: Complete</div>
                </div>

                <form id="paymentForm">
                    <div id="paymentStep1">
                        <h3>Step 1 of 4: Applicant Information</h3>
                        <div class="form-group">
                            <label for="p_name">Full Name on Card</label>
                            <input type="text" id="p_name" required>
                        </div>
                        <div class="form-group">
                            <label for="p_email">Email for Receipt</label>
                            <input type="email" id="p_email" required>
                        </div>
                        <button type="button" id="nextBtn1" class="form-action-btn" disabled>Next</button>
                    </div>

                    <div id="paymentStep2" style="display: none;">
                        <h3>Step 2 of 4: Payment Details</h3>
                        <div class="form-group">
                            <label for="p_card">Card Number</label>
                            <input type="text" id="p_card" pattern="\d{16}" placeholder="16 digits" required>
                        </div>
                        <div class="form-group">
                            <label for="p_cvv">CVV</label>
                            <input type="text" id="p_cvv" pattern="\d{3,4}" placeholder="3 or 4 digits" required>
                        </div>
                        <div class="form-group">
                            <label for="p_expiry">Expiry Date (Min: Dec 2025)</label>
                            <input type="month" id="p_expiry" value="2025-12" min="2025-12" required>
                        </div>
                        <button type="button" id="backBtn2" class="form-action-btn" style="background-color: #555;">Back</button>
                        <button type="button" id="nextBtn2" class="form-action-btn" disabled>Next</button>
                    </div>

                    <div id="paymentStep3" style="display: none;">
                        <h3>Step 3 of 4: Review and Confirm</h3>
                        <p>Please review your details before confirming payment.</p>
                        <ul id="reviewDetails" style="list-style: disc; padding-left: 20px; line-height: 1.8;"></ul>
                        <button type="button" id="backBtn3" class="form-action-btn" style="background-color: #555;">Back</button>
                        <button type="button" id="confirmPayBtn" class="form-action-btn" style="background-color: #008000;">Confirm & Pay <span id="paymentAmountDisplay"></span></button>
                    </div>

                    <div id="paymentStep4" style="display: none;">
                        <h3>Step 4 of 4: Payment Complete</h3>
                        <div id="paymentResult" class="message success"></div>
                        <button type="button" onclick="showSection('trackingSection')" class="form-action-btn">Return to Tracking Home</button>
                    </div>
                </form>
            </div>
            
        </main>
    </div>

    <footer>
        <p><strong>Embassy of Italy in Tehran Official Portal</strong></p>
        <p>&copy; 2025. All Rights Reserved. | Address: Tehran, Farmanieh, Lavasani St. | Contact: info@italyembassy.ir</p>
        <p>Disclaimer: This is a secure payment simulation portal.</p>
    </footer>

    <script>
        // 1. Data Structure (Shallow simulation of data.json)
        const applicantData = [
            {
                name: "فرهاد", // Must match Farsi input exactly
                lastName: "احسان",
                nationality: "افغان",
                nationalId: "101010",
                ceuNumber: "202020",
                caseType: "Humanitarian",
                approvalDate: "01/01/2025",
                interviewDate: "17/11/2025",
                paymentAmount: "230 EUR",
                referringOrganization: "UNHCR"
            }
        ];
        
        let currentApplicant = null;
        
        // Utility: Loading Handler
        const loadingOverlay = document.getElementById('loadingOverlay');
        const TRACKING_DURATION = 5000; // 5 seconds

        function showLoading() {
            loadingOverlay.classList.remove('hidden');
        }

        async function hideLoading() {
            return new Promise(resolve => {
                setTimeout(() => {
                    loadingOverlay.classList.add('hidden');
                    resolve();
                }, TRACKING_DURATION);
            });
        }
        
        function showSection(sectionId) {
            document.getElementById('trackingSection').style.display = 'none';
            document.getElementById('detailsSection').style.display = 'none';
            document.getElementById('paymentSection').style.display = 'none';
            
            const target = document.getElementById(sectionId);
            if (target) {
                target.style.display = 'block';
            }
        }

        // --- Initial Load ---
        window.addEventListener('load', () => {
            showLoading();
            hideLoading().then(() => {
                showSection('trackingSection');
            });
        });

        // --- 4. Tracking Logic ---

        const trackingForm = document.getElementById('trackingForm');
        const trackInputs = trackingForm.querySelectorAll('input');
        const trackBtn = document.getElementById('trackBtn');
        const trackMessage = document.getElementById('trackMessage');

        // Input Validation: Enable/Disable Track Button
        trackInputs.forEach(input => {
            input.addEventListener('input', () => {
                const allFilled = Array.from(trackInputs).every(i => i.value.trim() !== '');
                trackBtn.disabled = !allFilled;
                trackMessage.style.display = 'none'; 
            });
        });

        // Track Now Handler
        trackingForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            showLoading();

            const inputData = {
                name: document.getElementById('name').value.trim(),
                lastName: document.getElementById('lastName').value.trim(),
                nationality: document.getElementById('nationality').value.trim(),
                nationalId: document.getElementById('nationalId').value.trim(),
                ceuNumber: document.getElementById('ceuNumber').value.trim(),
            };

            await hideLoading();

            const foundApplicant = applicantData.find(applicant =>
                applicant.name === inputData.name &&
                applicant.lastName === inputData.lastName &&
                applicant.nationality === inputData.nationality &&
                applicant.nationalId === inputData.nationalId &&
                applicant.ceuNumber === inputData.ceuNumber
            );

            if (foundApplicant) {
                currentApplicant = foundApplicant;
                trackMessage.style.display = 'none';
                displayAppointmentDetails(foundApplicant);
                showSection('detailsSection');
            } else {
                trackMessage.classList.remove('success');
                trackMessage.classList.add('error');
                trackMessage.textContent = 'Error: The entered information was not found in our system. Please verify and try again.';
                trackMessage.style.display = 'block';
            }
        });

        // --- 5. Appointment Details Logic ---

        function displayAppointmentDetails(applicant) {
            const applicantInfoDiv = document.getElementById('applicantInfo');
            const details = [
                { label: 'Name and Last Name', value: `${applicant.name} ${applicant.lastName}` },
                { label: 'Nationality', value: applicant.nationality },
                { label: 'National ID No', value: applicant.nationalId },
                { label: 'CEU Number', value: applicant.ceuNumber },
                { label: 'Case Type', value: applicant.caseType },
                { label: 'Approval Date', value: applicant.approvalDate },
                { label: 'Scheduled Interview Date', value: applicant.interviewDate },
                { label: 'Payment Amount Due', value: applicant.paymentAmount },
                { label: 'Referring Organization', value: applicant.referringOrganization }
            ];

            applicantInfoDiv.innerHTML = details.map(item => `
                <div class="detail-item">
                    <strong>${item.label}</strong>
                    <span>${item.value}</span>
                </div>
            `).join('');
            
            document.getElementById('paymentAmountDisplay').textContent = applicant.paymentAmount;
            document.getElementById('confirmPayBtn').disabled = false;
        }

        // Proceed to Payment Button Handler
        document.getElementById('proceedPaymentBtn').addEventListener('click', async () => {
            showLoading();
            await hideLoading();
            
            // Setup initial payment step view
            document.getElementById('paymentStep1').style.display = 'block';
            document.getElementById('paymentStep2').style.display = 'none';
            document.getElementById('paymentStep3').style.display = 'none';
            document.getElementById('paymentStep4').style.display = 'none';
            
            document.getElementById('step1Header').classList.add('active');
            document.getElementById('step2Header').classList.remove('active');
            document.getElementById('step3Header').classList.remove('active');
            document.getElementById('step4Header').classList.remove('active');
            
            document.getElementById('p_expiry').value = '2025-12';
            checkPaymentStep1(); // Check Step 1 fields on navigation
            
            showSection('paymentSection');
        });


        // --- Payment Form Multi-Step Logic ---

        function updateStepHeader(step) {
            document.querySelectorAll('.progress-step').forEach(el => el.classList.remove('active'));
            document.getElementById(`step${step}Header`).classList.add('active');
        }
        
        function checkPaymentStep1() {
            const name = document.getElementById('p_name').value.trim();
            const email = document.getElementById('p_email').value.trim();
            const emailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email); // Basic email regex
            document.getElementById('nextBtn1').disabled = !(name.length > 0 && emailValid);
        }

        function checkPaymentStep2() {
            const card = document.getElementById('p_card').value.trim();
            const cvv = document.getElementById('p_cvv').value.trim();
            const expiry = document.getElementById('p_expiry').value.trim();
            
            const cardValid = /^\d{16}$/.test(card);
            const cvvValid = /^\d{3,4}$/.test(cvv);
            const expiryValid = expiry.length > 0 && new Date(expiry) >= new Date('2025-12'); // Check against December 2025

            document.getElementById('nextBtn2').disabled = !(cardValid && cvvValid && expiryValid);
        }
        
        // Listeners for step 1
        document.getElementById('p_name').addEventListener('input', checkPaymentStep1);
        document.getElementById('p_email').addEventListener('input', checkPaymentStep1);
        
        // Listeners for step 2
        document.getElementById('p_card').addEventListener('input', checkPaymentStep2);
        document.getElementById('p_cvv').addEventListener('input', checkPaymentStep2);
        document.getElementById('p_expiry').addEventListener('change', checkPaymentStep2);

        // Navigation Handlers
        document.getElementById('nextBtn1').addEventListener('click', async () => {
            showLoading();
            await hideLoading();
            document.getElementById('paymentStep1').style.display = 'none';
            document.getElementById('paymentStep2').style.display = 'block';
            updateStepHeader(2);
            checkPaymentStep2();
        });

        document.getElementById('nextBtn2').addEventListener('click', async () => {
            showLoading();
            await hideLoading();
            document.getElementById('paymentStep2').style.display = 'none';
            document.getElementById('paymentStep3').style.display = 'block';
            updateStepHeader(3);
            
            // Populate review details
            const reviewList = document.getElementById('reviewDetails');
            reviewList.innerHTML = `
                <li><strong>Amount Payable:</strong> ${currentApplicant.paymentAmount}</li>
                <li><strong>Name on Card:</strong> ${document.getElementById('p_name').value}</li>
                <li><strong>Email for Receipt:</strong> ${document.getElementById('p_email').value}</li>
                <li><strong>Card Number:</strong> XXXX-XXXX-XXXX-${document.getElementById('p_card').value.slice(-4)}</li>
                <li><strong>Expiry Month/Year:</strong> ${document.getElementById('p_expiry').value}</li>
            `;
        });
        
        // Back Button Handlers
        document.getElementById('backBtn2').addEventListener('click', () => {
            document.getElementById('paymentStep2').style.display = 'none';
            document.getElementById('paymentStep1').style.display = 'block';
            updateStepHeader(1);
        });

        document.getElementById('backBtn3').addEventListener('click', () => {
            document.getElementById('paymentStep3').style.display = 'none';
            document.getElementById('paymentStep2').style.display = 'block';
            updateStepHeader(2);
        });

        // Final Pay Button Handler
        document.getElementById('confirmPayBtn').addEventListener('click', async () => {
            showLoading();
            document.getElementById('confirmPayBtn').disabled = true;
            
            await hideLoading();
            
            document.getElementById('paymentStep3').style.display = 'none';
            document.getElementById('paymentStep4').style.display = 'block';
            updateStepHeader(4);

            const resultDiv = document.getElementById('paymentResult');
            resultDiv.textContent = `Payment of ${currentApplicant.paymentAmount} processed successfully. A confirmation receipt has been sent to ${document.getElementById('p_email').value}.`;
            resultDiv.style.display = 'block';
        });

    </script>
</body>
</html>

